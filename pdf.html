import fitz  # PyMuPDF, installieren mit: pip install pymupdf
import sys

def summarize_text(text, maxlen=250):
    # Sehr primitive Kurzfassung: Nur die ersten x Zeichen/Sätze
    # Hier könntest du ChatGPT/LLM/anderen Algorithmus verwenden!
    return text[:maxlen] + ("..." if len(text) > maxlen else "")

def main(pdf_path, kommentar_text, output_path):
    # PDF öffnen
    doc = fitz.open(pdf_path)
    # Gesamten Text extrahieren
    all_text = ""
    for page in doc:
        all_text += page.get_text()
    # Zusammenfassen
    summary = summarize_text(all_text)
    print("PDF-Kurzzusammenfassung:\n", summary)
    
    # Sticky Note hinzufügen (auf Seite 1, oben links)
    doc[0].add_text_annot((50, 800), kommentar_text)
    
    # Speichern
    doc.save(output_path)
    print(f"Fertig! Kommentar eingefügt. Neue Datei: {output_path}")

if __name__ == "__main__":
    if len(sys.argv) < 4:
        print("Verwendung: python pdf_annotator.py input.pdf 'Kommentartext' output.pdf")
        sys.exit(1)
    input_pdf = sys.argv[1]
    kommentar = sys.argv[2]
    output_pdf = sys.argv[3]
    main(input_pdf, kommentar, output_pdf)
