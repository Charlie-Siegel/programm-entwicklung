<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Ideenbank</title>
  <style>
    body { font-family: sans-serif; background: #f6faff; margin: 0;}
    #wrapper { max-width: 900px; margin: 34px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 12px #0002; padding: 30px; }
    h2 { color: #0287c2; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 24px;}
    th, td { border: 1px solid #e0e5ee; padding: 7px 10px; }
    th { background: #e6f2ff; }
    .btn { background: #e6f2ff; color: #0287c2; border: none; border-radius: 5px; padding: 5px 12px; cursor: pointer;}
    .btn:hover { background: #c8e4fa; }
    #formDiv { margin-bottom: 18px; }
    .small { font-size: 0.97em; color: #888;}
    #exportBtn, #importBtn { margin-right: 12px; }
    .add-btn { font-size: 1.1em; padding: 2px 7px; margin-left: 2px;}
  </style>
</head>
<body>
  <div id="wrapper">
    <h2>Ideenbank</h2>
    <div id="formDiv">
      <input id="titel" placeholder="Titel" style="width:130px;">
      <select id="kategorie" style="width:120px;"></select>
      <button class="btn add-btn" onclick="addKategorie()" title="Kategorie hinzuf√ºgen">+</button>
      <select id="status" style="width:120px;"></select>
      <button class="btn add-btn" onclick="addStatus()" title="Status hinzuf√ºgen">+</button>
      <input id="datum" type="date" style="width:120px;">
      <input id="beschreibung" placeholder="Beschreibung" style="width:210px;">
      <button class="btn" onclick="addIdee()">‚ûï Hinzuf√ºgen</button>
    </div>
    <div style="margin-bottom:12px;">
      <button class="btn" id="exportBtn" onclick="exportIdeen()">‚§ì Exportieren</button>
      <button class="btn" id="importBtn" onclick="document.getElementById('importFile').click()">‚§í Importieren</button>
      <input type="file" id="importFile" accept=".json" style="display:none">
    </div>
    <table id="ideenTabelle">
      <thead>
        <tr>
          <th>Titel</th><th>Kategorie</th><th>Status</th><th>Datum</th><th>Beschreibung</th><th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="small">Status/Kategorien k√∂nnen per ‚Äû+‚Äú erg√§nzt werden.<br>
      Ideen k√∂nnen jetzt exportiert/importiert werden. Exportiert wird im 5GL-Format.<br>
      <b>Tipp:</b> Beim Import werden die Kategorien und Status der importierten Ideen automatisch √ºbernommen, falls sie noch nicht existieren.
    </div>
  </div>
  <script>
    let ideen = [];
    let kategorien = ["Tool", "Export", "Organisation"];
    let stati = ["offen", "in Arbeit", "erledigt", "wichtig"];

    function renderDropdowns() {
      // Kategorie
      let selKat = document.getElementById("kategorie");
      selKat.innerHTML = "";
      kategorien.forEach(k => selKat.innerHTML += `<option>${k}</option>`);
      // Status
      let selStat = document.getElementById("status");
      selStat.innerHTML = "";
      stati.forEach(s => selStat.innerHTML += `<option>${s}</option>`);
    }

    function renderTabelle() {
      let tb = document.querySelector("#ideenTabelle tbody");
      tb.innerHTML = "";
      for (let idee of ideen) {
        tb.innerHTML += `<tr>
          <td>${idee.titel}</td>
          <td>${idee.kategorie || ""}</td>
          <td>${idee.status || ""}</td>
          <td>${idee.datum || ""}</td>
          <td>${idee.beschreibung}</td>
          <td><button class="btn" onclick="deleteIdee(${idee.id})">üóëÔ∏è</button></td>
        </tr>`;
      }
    }

    function addKategorie() {
      let kat = prompt("Neue Kategorie anlegen:");
      if (!kat) return;
      if (kategorien.includes(kat)) { alert("Kategorie existiert schon."); return; }
      kategorien.push(kat);
      renderDropdowns();
      document.getElementById("kategorie").value = kat;
    }

    function addStatus() {
      let stat = prompt("Neuen Status anlegen:");
      if (!stat) return;
      if (stati.includes(stat)) { alert("Status existiert schon."); return; }
      stati.push(stat);
      renderDropdowns();
      document.getElementById("status").value = stat;
    }

    function addIdee() {
      let titel = document.getElementById("titel").value.trim();
      let kategorie = document.getElementById("kategorie").value;
      let datum = document.getElementById("datum").value || (new Date()).toISOString().slice(0,10);
      let status = document.getElementById("status").value;
      let beschreibung = document.getElementById("beschreibung").value.trim();
      if (!titel) { alert("Bitte Titel angeben."); return; }
      let id = (ideen.length ? Math.max(...ideen.map(i=>i.id))+1 : 1);
      ideen.push({id, titel, kategorie, datum, status, beschreibung});
      renderTabelle();
      document.getElementById("titel").value = "";
      document.getElementById("beschreibung").value = "";
    }

    function deleteIdee(id) {
      if (!confirm("Idee wirklich l√∂schen?")) return;
      ideen = ideen.filter(i => i.id !== id);
      renderTabelle();
    }

    function exportIdeen() {
      let blob = new Blob([JSON.stringify({
        ideen,
        kategorien,
        stati
      }, null, 2)], {type:"application/json"});
      let a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'ideenbank.json';
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>document.body.removeChild(a), 400);
    }

    document.getElementById('importFile').onchange = function(e) {
      let file = e.target.files[0];
      if (!file) return;
      let reader = new FileReader();
      reader.onload = function(evt) {
        try {
          let data = JSON.parse(evt.target.result);
          if (!data.ideen || !Array.isArray(data.ideen)) throw new Error("Formatfehler: Array 'ideen' fehlt!");
          // Neue Kategorien und Stati aus Import erg√§nzen:
          if (Array.isArray(data.kategorien)) {
            data.kategorien.forEach(kat => { if (!kategorien.includes(kat)) kategorien.push(kat); });
          }
          if (Array.isArray(data.stati)) {
            data.stati.forEach(stat => { if (!stati.includes(stat)) stati.push(stat); });
          }
          // Importierte Ideen (IDs neu vergeben, falls n√∂tig)
          let nextId = ideen.length ? Math.max(...ideen.map(i=>i.id)) + 1 : 1;
          data.ideen.forEach((idee, idx) => {
            idee.id = nextId++;
            ideen.push(idee);
          });
          renderDropdowns();
          renderTabelle();
        } catch (err) {
          alert("Fehler beim Importieren:\n" + err.message);
        }
      };
      reader.readAsText(file);
    };

    // Starteintr√§ge (Demo, kann gel√∂scht werden)
    ideen = [
      {id:1, titel:"Methodenbank-Editor", kategorie:"Tool", datum:"2024-07-09", status:"offen", beschreibung:"Im Browser Methoden direkt anlegen, bearbeiten und l√∂schen."},
      {id:2, titel:"Code-/Doku-Export", kategorie:"Export", datum:"2024-07-09", status:"offen", beschreibung:"Automatischer Export der Methodenbank als Markdown oder HTML."},
      {id:3, titel:"Vergleich von Methodenbanken", kategorie:"Tool", datum:"2024-07-09", status:"offen", beschreibung:"Zwei JSON-Methodenbanken auf Unterschiede pr√ºfen und visualisieren."},
      {id:4, titel:"Ideenlogbuch integrieren", kategorie:"Organisation", datum:"2024-07-09", status:"offen", beschreibung:"Alle Systemideen und -vorschl√§ge werden gespeichert und k√∂nnen bearbeitet werden."}
    ];
    renderDropdowns();
    renderTabelle();
  </script>
</body>
</html>
