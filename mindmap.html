<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Mini-Mindmap mit Drag & Drop</title>
  <style>
    body { margin:0; background: #f7fafc; font-family:sans-serif;}
    #canvas { width: 100vw; height: 92vh; background: #eef6fa; position:relative; overflow: hidden; }
    .node {
      position: absolute;
      min-width: 120px;
      max-width: 220px;
      padding: 10px 18px;
      border-radius: 16px;
      background: #fff;
      box-shadow: 0 2px 8px #0002;
      cursor: move;
      text-align: center;
      user-select: none;
      border: 2px solid #78befa;
      font-weight: bold;
      font-size: 1em;
      transition: box-shadow 0.1s;
    }
    .node.selected { border-color: #ff7b00; box-shadow: 0 0 8px #ffa50077; }
    .toolbar { padding: 8px; background: #eee;}
    button { margin-right: 10px; }
    .btn { font-size: 1em; background: none; border: none; cursor: pointer; padding: 2px 6px; }
    .btn:active { background: #e5e5e5; border-radius: 6px; }
    .comment { font-size:0.9em; color:#2681c0; margin-top:6px; white-space:pre-line;}
  </style>
</head>
<body>
  <div class="toolbar">
    <button onclick="addNodePrompt()">‚ûï Knoten hinzuf√ºgen</button>
    <button onclick="downloadMap()">üíæ Speichern</button>
    <button onclick="document.getElementById('fileInput').click()">üìÇ Laden</button>
    <input type="file" id="fileInput" style="display:none" accept=".json">
  </div>
  <div id="canvas"></div>
  <script>
    // --- Mindmap Grundstruktur
    let mindmap = {
      nodes: [
        {id: 1, title: "5GL-Baustein-Sammlung", x: 400, y: 180, comment:"", parent: null},
        {id: 2, title: "Bausteinverwaltung", x: 170, y: 80, comment:"", parent: 1},
        {id: 3, title: "Klassendesigner", x: 630, y: 80, comment:"", parent: 1},
        {id: 4, title: "Logbuch", x: 100, y: 260, comment:"", parent: 1},
        {id: 5, title: "Hilfedokumentation", x: 700, y: 260, comment:"", parent: 1},
        {id: 6, title: "Vorschau & Simulation", x: 200, y: 380, comment:"", parent: 1},
        {id: 7, title: "Dateiverwaltung", x: 620, y: 380, comment:"", parent: 1},
        {id: 8, title: "User & Rollen", x: 400, y: 450, comment:"", parent: 1},
        {id: 9, title: "Projektverwaltung/Doku", x: 400, y: 40, comment:"", parent: 1},
      ]
    };
    let nodeId = 10;
    let dragNode = null, offsetX = 0, offsetY = 0;

    // --- Render-Funktion
    function render() {
      const canvas = document.getElementById('canvas');
      canvas.innerHTML = "";
      // SVG-Linien
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.style.position = "absolute";
      svg.style.top = "0";
      svg.style.left = "0";
      svg.setAttribute("width", canvas.offsetWidth);
      svg.setAttribute("height", canvas.offsetHeight);

      mindmap.nodes.forEach(n => {
        if (n.parent) {
          const p = mindmap.nodes.find(nn => nn.id === n.parent);
          if (p) {
            let x1 = p.x + 60, y1 = p.y + 24;
            let x2 = n.x + 60, y2 = n.y + 24;
            let line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", x1);
            line.setAttribute("y1", y1);
            line.setAttribute("x2", x2);
            line.setAttribute("y2", y2);
            line.setAttribute("stroke", "#2a99e7");
            line.setAttribute("stroke-width", "3");
            svg.appendChild(line);
          }
        }
      });
      canvas.appendChild(svg);

      mindmap.nodes.forEach(n => {
        let div = document.createElement("div");
        div.className = "node";
        div.style.left = n.x + "px";
        div.style.top = n.y + "px";
        div.innerHTML = `
          <span>${escapeHTML(n.title)}</span>
          <button class="btn" onclick="editNode(${n.id});event.stopPropagation();">‚úèÔ∏è</button>
          ${n.id !== 1 ? `<button class="btn" onclick="deleteNode(${n.id});event.stopPropagation();">üóëÔ∏è</button>` : ""}
          <button class="btn" onclick="addChildNode(${n.id});event.stopPropagation();">‚ûï</button>
          <div class="comment">${n.comment ? escapeHTML(n.comment) : "<span style='color:#bbb;'>(kein Kommentar)</span>"}</div>
        `;
        // Drag&Drop
        div.onmousedown = e => {
          if(e.target.tagName==="BUTTON") return;
          dragNode = n;
          offsetX = e.offsetX;
          offsetY = e.offsetY;
          div.classList.add("selected");
        };
        div.onmouseup = e => { dragNode = null; div.classList.remove("selected"); };
        canvas.appendChild(div);
      });
    }

    // --- Interaktion
    function addNodePrompt() {
      let parent = prompt("Zu welchem Knoten soll der neue Ast geh√∂ren? Gib die ID ein (z.B. 1 f√ºr Root):", "1");
      if(!mindmap.nodes.some(n => n.id == parent)) { alert("ID nicht gefunden!"); return;}
      let title = prompt("Titel des neuen Knotens?");
      if (!title) return;
      mindmap.nodes.push({id: nodeId++, title: title, x: 350+Math.random()*100, y: 200+Math.random()*100, comment:"", parent: Number(parent)});
      render();
    }
    function addChildNode(parentId) {
      let title = prompt("Titel des neuen Unter-Knotens?");
      if (!title) return;
      mindmap.nodes.push({id: nodeId++, title: title, x: 350+Math.random()*100, y: 200+Math.random()*100, comment:"", parent: parentId});
      render();
    }
    function editNode(id) {
      let n = mindmap.nodes.find(nn=>nn.id===id);
      let title = prompt("Neuer Name des Knotens:", n.title);
      if(title) n.title = title;
      let comment = prompt("Kommentar/Notiz f√ºr diesen Knoten:", n.comment);
      if(comment !== null) n.comment = comment;
      render();
    }
    function deleteNode(id) {
      if (!confirm("Knoten und alle darunter l√∂schen?")) return;
      const removeRec = id => {
        mindmap.nodes.filter(n => n.parent === id).forEach(n => removeRec(n.id));
        mindmap.nodes = mindmap.nodes.filter(n => n.id !== id);
      };
      removeRec(id);
      render();
    }

    // Drag&Drop global
    document.body.onmousemove = function(e) {
      if (!dragNode) return;
      dragNode.x = e.clientX - offsetX;
      dragNode.y = e.clientY - offsetY - document.querySelector(".toolbar").offsetHeight;
      render();
    }
    document.body.onmouseup = function() { dragNode = null; render(); };

    // Speichern / Laden
    function downloadMap() {
      let data = JSON.stringify(mindmap, null, 2);
      let blob = new Blob([data], {type:"application/json"});
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url; a.download = "mindmap.json";
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }
    document.getElementById('fileInput').onchange = function(e) {
      let file = e.target.files[0];
      if (!file) return;
      let reader = new FileReader();
      reader.onload = function(evt) {
        mindmap = JSON.parse(evt.target.result);
        nodeId = Math.max(...mindmap.nodes.map(n=>n.id))+1;
        render();
      };
      reader.readAsText(file);
    };

    // Hilfsfunktion
    function escapeHTML(str) { return (str||"").replace(/[&<>"]/g, ch=>({ "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;" }[ch])); }

    // Initial Render
    render();
  </script>
</body>
</html>
