<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Mini-Mindmap mit Drag & Drop</title>
  <style>
    body { margin:0; background: #f7fafc; font-family:sans-serif;}
    #canvas { width: 100vw; height: 92vh; background: #eef6fa; position:relative; overflow: hidden; }
    .node {
      position: absolute;
      min-width: 100px;
      padding: 12px 20px;
      border-radius: 16px;
      background: #fff;
      box-shadow: 0 2px 8px #0002;
      cursor: move;
      text-align: center;
      user-select: none;
      border: 2px solid #78befa;
      font-weight: bold;
      font-size: 1em;
    }
    .node.selected { border-color: #ff7b00; }
    .toolbar { padding: 8px; background: #eee;}
    button { margin-right: 10px; }
    .node-edit { font-size:0.9em; background: #f7f7f7; border-radius:8px; margin-top:6px; }
    .add-btn { font-size:0.9em; margin-left: 5px; }
  </style>
</head>
<body>
  <div class="toolbar">
    <button onclick="addNode()">âž• Knoten hinzufÃ¼gen</button>
    <button onclick="downloadMap()">ðŸ’¾ Speichern</button>
    <button onclick="document.getElementById('fileInput').click()">ðŸ“‚ Laden</button>
    <input type="file" id="fileInput" style="display:none" accept=".json">
  </div>
  <div id="canvas"></div>
  <script>
    // --- Mindmap Grundstruktur
    let mindmap = {
      nodes: [
        {id: 1, title: "5GL-Baustein-Sammlung", x: 400, y: 180, comment:"", parent: null},
        {id: 2, title: "Bausteinverwaltung", x: 170, y: 80, comment:"", parent: 1},
        {id: 3, title: "Klassendesigner", x: 630, y: 80, comment:"", parent: 1},
        {id: 4, title: "Logbuch", x: 100, y: 260, comment:"", parent: 1},
        {id: 5, title: "Hilfedokumentation", x: 700, y: 260, comment:"", parent: 1},
        {id: 6, title: "Vorschau & Simulation", x: 200, y: 380, comment:"", parent: 1},
        {id: 7, title: "Dateiverwaltung", x: 620, y: 380, comment:"", parent: 1},
        {id: 8, title: "User & Rollen", x: 400, y: 450, comment:"", parent: 1},
        {id: 9, title: "Projektverwaltung/Doku", x: 400, y: 40, comment:"", parent: 1},
      ]
    };
    let nodeId = 10;
    let dragNode = null, offsetX = 0, offsetY = 0;

    // --- Render-Funktion
    function render() {
      const canvas = document.getElementById('canvas');
      canvas.innerHTML = "";
      // SVG-Linien
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.style.position = "absolute";
      svg.style.top = "0";
      svg.style.left = "0";
      svg.setAttribute("width", canvas.offsetWidth);
      svg.setAttribute("height", canvas.offsetHeight);

      mindmap.nodes.forEach(n => {
        if (n.parent) {
          const p = mindmap.nodes.find(nn => nn.id === n.parent);
          if (p) {
            let x1 = p.x + 60, y1 = p.y + 24;
            let x2 = n.x + 60, y2 = n.y + 24;
            let line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", x1);
            line.setAttribute("y1", y1);
            line.setAttribute("x2", x2);
            line.setAttribute("y2", y2);
            line.setAttribute("stroke", "#2a99e7");
            line.setAttribute("stroke-width", "3");
            svg.appendChild(line);
          }
        }
      });
      canvas.appendChild(svg);

      // Nodes
      mindmap.nodes.forEach(n => {
        let div = document.createElement("div");
        div.className = "node";
        div.style.left = n.x + "px";
        div.style.top = n.y + "px";
        div.textContent = n.title;
        div.draggable = false;
        div.onclick = e => { selectNode(n.id); e.stopPropagation(); };
        div.onmousedown = e => {
          dragNode = n;
          offsetX = e.offsetX;
          offsetY = e.offsetY;
          div.classList.add("selected");
        };
        div.onmouseup = e => { dragNode = null; div.classList.remove("selected"); };
        div.onmousemove = e => {
          if (dragNode === n) {
            n.x = e.clientX - offsetX;
            n.y = e.clientY - offsetY - document.querySelector(".toolbar").offsetHeight;
            render();
          }
        };
        // Edit/Del-Icons als kleine Buttons
        let edit = document.createElement("span");
        edit.className = "add-btn";
        edit.textContent = "âœï¸";
        edit.title = "Bearbeiten";
        edit.onclick = ev => { editNode(n.id); ev.stopPropagation(); };
        let del = document.createElement("span");
        del.className = "add-btn";
        del.textContent = "ðŸ—‘ï¸";
        del.title = "LÃ¶schen";
        del.onclick = ev => { deleteNode(n.id); ev.stopPropagation(); };
        div.appendChild(edit);
        if(n.id !== 1) div.appendChild(del);
        canvas.appendChild(div);
      });
    }

    function selectNode(id) {
      mindmap.nodes.forEach(n => n.selected = n.id === id);
      render();
    }

    function addNode() {
      const parentNodes = mindmap.nodes.filter(n => true);
      let parent = prompt("Zu welchem Knoten soll der neue Ast gehÃ¶ren? Gib die ID ein (z.B. 1 fÃ¼r Root):", "1");
      if(!parentNodes.some(n => n.id == parent)) { alert("ID nicht gefunden!"); return;}
      let title = prompt("Titel des neuen Knotens?");
      if (!title) return;
      mindmap.nodes.push({id: nodeId++, title: title, x: 350+Math.random()*100, y: 200+Math.random()*100, comment:"", parent: Number(parent)});
      render();
    }

    function editNode(id) {
      let n = mindmap.nodes.find(nn=>nn.id===id);
      let title = prompt("Neuer Name des Knotens:", n.title);
      if(title) n.title = title;
      let comment = prompt("Kommentar/Notiz fÃ¼r diesen Knoten:", n.comment);
      if(comment !== null) n.comment = comment;
      render();
    }

    function deleteNode(id) {
      if (!confirm("Knoten und alle darunter lÃ¶schen?")) return;
      const removeRec = id => {
        mindmap.nodes.filter(n => n.parent === id).forEach(n => removeRec(n.id));
        mindmap.nodes = mindmap.nodes.filter(n => n.id !== id);
      };
      removeRec(id);
      render();
    }

    // Drag&Drop global (fÃ¼r bessere Usability)
    document.body.onmousemove = function(e) {
      if (!dragNode) return;
      dragNode.x = e.clientX - offsetX;
      dragNode.y = e.clientY - offsetY - document.querySelector(".toolbar").offsetHeight;
      render();
    }
    document.body.onmouseup = function() { dragNode = null; render(); };

    // Speichern / Laden
    function downloadMap() {
      let data = JSON.stringify(mindmap, null, 2);
      let blob = new Blob([data], {type:"application/json"});
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url; a.download = "mindmap.json";
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }
    document.getElementById('fileInput').onchange = function(e) {
      let file = e.target.files[0];
      if (!file) return;
      let reader = new FileReader();
      reader.onload = function(evt) {
        mindmap = JSON.parse(evt.target.result);
        nodeId = Math.max(...mindmap.nodes.map(n=>n.id))+1;
        render();
      };
      reader.readAsText(file);
    };

    // Initial Render
    render();
  </script>
</body>
</html>
